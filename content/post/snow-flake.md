---
title: "分布式唯一ID生成:雪花算法"
date: 2019-09-11T10:19:59+08:00
draft: true
tags: ["分布式"]
categories: "microservice"
toc: true
---
&emsp;雪花算法是一种在分布式系统中唯一ID生成的算法。这种算法最早由Twitter发起，这些ID是唯一的64位无符号整数，他们支持按照时间有序生成。

### 1.0 现有方案
#### 1.1 UUID
&emsp;UUID是目前最主流的唯一ID生成方案，它是全局唯一的128位十六进制数字，两次生成UUID的可能性几乎可以忽略不计。

&emsp;但UUID最大的问题在于他相对较长，而且是无序的，因此对索引的支持也非常不好。随着数据集的不断增加，索引大小也会增加，查询效率会受到影响。

### 2.0 雪花算法
&emsp;雪花算法生成的ID的结构如下(共分为5个部分，每部分用-分开):
```aidl
0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000
```

- `1位标识部分:`在java中，long的最高位是符号位，0表示正数，1表示负数。一般我们生成的都是正数。
- `41位时间戳部分:`这个是毫秒级的时间，一般实现上不会存储当前的时间戳，而是时间戳的差值（当前时间-固定的开始时间），这样可以使产生的ID从更小值开始；41位的时间戳可以使用69年，(1L << 41) / (1000L 60 60 24 365) = 69年；
- `5位数据中心标识:`这5位为数据中心标识
- `5位机器标识:`这5位为机器标识
- `12位序列号部分`: 在同一毫秒，同一节点上自增，支持每毫秒生成4096个序列ID

&emsp;雪花算法生成的ID在毫秒内自增，且在分布式环境下，通过数据中心与机器作为标识，不会产生ID碰撞。雪花算法每秒能够产生26万个ID。


### 3.0 参考资料
Twitter的分布式雪花算法 SnowFlake 每秒自增生成26个万个可排序的ID (Java版) https://segmentfault.com/a/1190000013703649

全局唯一Id:雪花算法 https://www.cnblogs.com/sheseido/p/9391235.html



