---
title: "CAP介绍"
date: 2019-09-04T22:20:31+08:00
draft: true
tags: ["分布式"]
categories: "microservice"
toc: true
---
&emsp;现在分布式系统越来越成为企业主流的架构模式。分布式系统的最大难点，在于各个节点的状态如何同步，CAP是该方面的基本定理。

### 1.0 三个指标
&emsp;CAP定理由三个指标组成，指的是一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），三者不可得兼。

- `Consistency（一致性）`: 在分布式系统中所有的数据备份，在同一时刻进行读操作都会返回同样的值。
- `Availability（可用性）`: 在分布式系统中，一部分节点故障后，是否还能响应客户端的读写请求。
- `Partition tolerance（分区容错性）`: 在分布式系统中，如果集群中的机器分成了两部分，两部分不能互相通信，系统仍然能够继续工作。

### 2.0 CAP定理论证
&emsp;我们来证明下，为什么不能同时满足三个特性？
&emsp;假设网络中有两个节点，分别为G1和G2，节点中存在两个应用(A1与A2)以及两个相同的数据(D1)。
![网络节点分布](../images/distributed/网络节点分布.jpg)
&emsp;在正常情况下，

### 3.0 取舍策略
&emsp;CAP三个特性只能满足其中两个，那么有三种策略:

- `CA:`如果需要满足可用性(A)和一致性(C)的要求，对系统进行一个数据写入操作，要求所有的系统同时更新才能成功。如果此时出现网络故障，分区容错性(P)是无法保证的，也放弃了系统的扩展性（即分布式节点受限），无法部署子节点，这违背分布式的初衷。
- `CP:`一个系统若要满足一致性(C)和分区容忍性(P)，对数据进行写入操作是，必须同时写入所有节点才算成功；如果有一个写入失败，将停止写入操作只提供读操作。但此时分区(P)也会导致同步时间无限延长，可用性(A)无法保证。
- `AP:`一个系统若要满足可用性(A)和分区容忍性(P)，当对某个节点进行写操作时，其他节点会通过异步方式同步。就算同步出现异常或延迟，不会影响服务，但会造成短暂的数据不一致(C)。

&emsp;对于大部分互联网应用，需要优先保证服务的可用性，一般都是采用AP。虽然会造成短暂的客户体验，但不至于造成由于服务不可用造成的用户流失。

&emsp;涉及到金钱方面，一般都是保证CP，宁可停止服务，也要保证服务的一致性。