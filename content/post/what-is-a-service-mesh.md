---
title: "Service Mesh是什么？以及为什么我们需要他"
date: 2019-08-07T21:40:35+08:00
draft: true
tags: ["service mesh"]
categories: "microservice"
toc: false
---
&emsp;Service Mesh是一个专用的基础设施层，用于在服务与服务之间建立安全、快速和可靠的通信。如果你正在构建一个云原生应用，你就需要service Mesh。  

&emsp;在过去的一年里，Service Mesh已经成为了云原生栈中重要的组成部分。一些高流量公司，例如：Paypal、Ticketmaster和Credit Karma已经将Service Mesh应用在生产环境中，在今年一月（2017年1月），Linkerd和其他一些开源的云原生应用已经成为了CNCF的正式项目。但是什么是Service Mesh？另外，为什么他们变得相关？ 

&emsp;在这篇文章中，我将会定义Service Mesh，并通过过去十年中应用架构的变化来追踪。我将分别将Service Mesh与API网关、边缘代理和企业服务总线作对比，介绍他们的相关性与不同。最终，我将描述Service Mesh的发展方向，以及他是如何随着云原生而发展的。  

### 什么是Service Mesh

&emsp;Service Mesh是一个专用的基础设施层，用于解决服务与服务之间的通信。它负责在复杂的云原生服务拓扑之间进行可靠的请求传输。事实上，Service Mesh是由一系列轻量级的网络代理组成，这些代理与应用程序部署在一起，而应用程序本身不需要去关心这些。

&emsp;Service Mesh的作为一个单独层与云原生应用的兴起有关，在云原生模型中，一个单一应用可以有数百个服务组成，每个服务可能存在数千个实例，并且每个实例都处在不段变化的状态，因为他们可以被像kubernetes这种协调器动态调度。这不仅仅是因为当前世界上的服务通信复杂，而是这也是运行时行为中最普遍和基本的一种。因此管理它们，保证服务端到端的性能和可靠性是至关重要的。

### Service Mesh是一种网络模型吗？
&emsp;Service Mesh是一种网络模型，它建立在位于TCP/IP协议之上的抽象层。他假定底层L3/L4之间可以实现点到点之间的字节传输。（它也假定这个网络和其他环境一样不可靠，因此，Service Mesh必须有能力处理网络故障。）

&emsp;在某些方面，Service Mesh类似于TCP/IP。就类似于TCP栈抽象了在网络端点之间可靠地传递字节的机制一样，Service Mesh抽象了服务之间的可靠请求传输。就如TCP一样，Service Mesh不关心有效载荷或它是如何编码的。应用的目标是从A将东西传输至B，而Service Mesh的工作，类似于TCP，是实现解决实现这个目标的过程中的故障。

&emsp;不同于TCP，Service Mesh有一个最重要的目标:让它工作。它提供了一个统一的应用级别埋点，用于在应用运行时，变得可见可控。服务网格的明确目标是将服务通信从不可见的基础设施领域移出，并转变为生态系统的首要角色 - 可以对其进行监控，管理和控制。

### Service Mesh干什么用？

&emsp;在云原生应用中，可靠的请求传输是十分复杂的。像linkerd这样的Service Mesh采用了一系列的强大技术来管理这些复杂传输，例如：熔断、延迟感知负载均衡、最终一致性服务发现和请求重试。这些技术会互相合作，使目前复杂环境的得以控制。

&emsp;例如，当一个服务通过linkerd发送请求，会经过如下一些几个行为：

1. Linkerd采用动态路由来决定那个服务是请求方想要调用的。请求需要被路由至生产环境或其他环境吗？这个服务是在本地数据中心或在云上？对于正在测试的最新版本，或对于生产环境的旧版本需要审核？所有的路由规则都是可以动态配置，可以采用于全局或各种流量并发情况。
2. 当发现了正确的目的地，Linkerd