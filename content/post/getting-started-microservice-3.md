---
title: "微服务架构系列之三：注册中心"
date: 2019-11-21T22:07:42+08:00
draft: false
categories: "microservice"
toc: true
---
&emsp;在微服务架构下，我们应用的数量也在呈几何级增长。那么各个应用之间进行交互成了重点，而应用与应用之间如何获取对方的信息成了至关重要的一点。

### 1.0 原理
&emsp;这时候，我们就需要注册中心。注册中心的目的就是将部署服务的信息（例如：服务器ip、端口、实例名等）记录到注册中心，当服务消费者有需求的时候，只需要查询注册中心，输入需要调用的服务名，就可以得到地址，从而发起调用。

&emsp;根据上述的描述，我们发现在这个流程中，有三个重要角色。

- 服务注册中心
- 服务提供者
- 服务消费者

![微服务注册中心](../images/microservice/微服务注册中心.jpg)

&emsp;在注册中心架构下，需要如下几个步骤和功能：

1. 服务提供者在启动时，向注册中心注册自身服务，并向注册中心定期发送心跳汇报存活状态。

2. 服务消费者在启动时，会向注册中心拉取所有注册在注册中心的服务列表，并将其缓存在本地内存中。

3. 当服务提供者发生变更时或心跳出现异常时，注册中心会同步变更。变更的结果会反馈给服务消费者，消费者会刷新自身的服务列表。

4. 当服务消费者需要调用服务提供者的时候，会从自身缓存的服务列表中，基于负载均衡算法选择一台服务提供者发起调用。

### 2.0 常见的服务注册中心

#### 2.1 Dubbo
&emsp;以下是Dubbo的官方架构图，可以看到registry(注册中心)位于整个架构的顶端，所有的服务治理相关的都是围绕它在进行的。

![dubbo架构.png](../images/microservice/dubbo架构.png)

&emsp;Dubbo支持多种注册中心的实现，其中最常用的就是Zookeeper。它满足了[CAP](http://jovi.io/post/cap-introduce/)中的CP。这代表着他是一个强一致性的产品，在集群分区时，它会优先保证一致性而舍弃可用性。所有zookeeper在所有端的数据访问都是一致的。

#### 2.2 Eureka

&emsp;Eureka有Netflix公司开源，目前被Spring Cloud用于注册中心。与Zookeeper不同，它天然就具有注册中心的功能。并且Eureka优先保证了服务的可用性，采用了去中心化的概念，整个服务集群由对等节点组成，无需像Zookeeper那样选举主节点。

&emsp;Eureka每个节点都具有失效转移的能力，如果某个Eureka节点失效，则可以自动切换到其他节点。这样就能保证服务的可用性，但随之而来的是数据一致性的丢失。
