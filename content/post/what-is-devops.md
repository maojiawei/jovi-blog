---
title: "什么是Devops-Facebook案例|DevOps工具"
date: 2019-03-18T16:56:04+08:00
draft: false
categories: "devops"
---
&emsp;了解什么是DevOps的关键是了解DevOps的意图，旨在编写优质的软件，能够更快更可靠地创建在团队间建立联系和合作。在团队间，我们通过有两个团队：开发团队和运维团队。   
&emsp;事实上，不是因为好的软件催化了两个团队之间的合作，而是由于"开发"和"运维"之间的合作，导致了软件的改进，加速交付效率。当然，我们不能忘记DevOps工具在自动化中所起的作用。他们在基础之上，支持整个DevOps的实现。  
&emsp;"一体"的感觉是由开发人员和运维人员之间的技能组合和时间为桥梁，加上自动化(DevOps)工具实现的。世界的领先组织都在采用DevOps来彻底改进其性能，安全以及团队动态。  
&emsp;在这篇博客中，我们一起寻找什么是DevOps，为什么这是个大问题！我们首先将跟踪一个软件开发的演化历史引导DevOps，再探索什么是DevOps以及他的生命周期，最后，我们将介绍一个世界级大公司，例如Facebook是如何使用DevOps，并为他带来收益的。

## 软件开发的演进史
&emsp;DevOps来源于现存的软件开发方法论以适应业务需要。让我们简短地看下这些模型演变的以及适用于哪些场景。  
 ![软件开发的演进史](../images/devops/Evolution-of-Software-Development.jpg)
&emsp;缓慢笨重的瀑布模型演化成为了敏捷，敏捷中要求每两周有一个冲刺(Sprint)。如此短的发布周期要求开发团队在下一个版本能够响应客户，互相合作，修改bug。虽然这种敏捷SCRUM的方式能够为开发带来灵活性，但在运维方面却失去了敏捷实践的速度。在开发工程师与运维工程师之前的合作缺失会减低软件开发过程和发布。DevOps方法论就产生于对更多合作和更快交付的需求。DevOps建立在简化复杂问题，快速解决问题的基础上进行持续软件交付。现在，我们了解了DevOps的演化，一起来详细看看什么是DevOps。

## 什么是DevOps

&emsp;DevOps是一种软件开发方式，它包含了在软件开发周期内的持续开发，持续测试，测试集成，持续部署以及持续监控。这些活动不仅对于DevOps，并且对于敏捷或者瀑布都是非常有用的，这就是为什么Facebook以及其他顶尖企业选择DevOps作为一种实现他们业务目标的方式。DevOps能够以一种更好地方式，以最少的时间开发高质量的软件，来达到更高的客户满意度。  
&emsp;如果不看这个生命周期图的话，你对于什么是DevOps是不完全的。下图揭露了他们是如何关联与软件开发的。

## 持续开发
&emsp;在这个阶段，所有的开发都是持续的。相比瀑布模型，软件交付被分割成多个短周期的冲刺。这个阶段包含了编码和构建过程，可以采用GIT或者SVN来管理代码的不同版本，还有Ant、Maven、Gradle来将代码构建和打包成可执行文件，给测试人员测试。

## 持续测试
&emsp;在这个阶段，开发的系统需要持续测试以查找漏洞。Selenium，TestNG,Junit等等都可以帮助进行持续测试，自动化测试。这些工具可以帮助测试人员并行测试来保证功能。在这个阶段，使用Docker容器来模拟出一个测试环境也是个不错的选择。一旦代码测试通过，就能持续地与历史代码进行合并。

## 持续集成
&emsp;在这个阶段，新的功能代码需要持续地集成进历史代码中。正因为有了持续开发，更新的代码需要不断地被集成，以便于系统可以将更新的内容反映给终端用户。被修改的代码必须保证它在可运行环境中没有问题，允许测试并且验证是否影响其他功能。  
&emsp;Jenkins在持续集成中是最常用的工具。当使用Jenkins的时候，可以从GIT仓库中拉取最新的代码，并将代码构建成可以部署至测试或生产环境的程序。它可以设定一旦有代码提交至GIT仓库自动构建或者手动构建。  

## 持续部署
&emsp;在这个阶段，代码可以部署至生产环境。然而，我们必须确保代码可以完整准确地部署在所有的服务器上。如果有新的功能或者特性，那还需要考虑是否会产生更多的流量。所以，系统管理员也需要扩充服务器来支持更多的用户。  
&emsp;在新代码部署过程中，配置管理工具也起了至关重要的作用，它可以帮助部署更快，更顺利地完成。Puppet、Chef、SaltStack和Ansible也是该阶段常用的工具。  
&emsp;容器化在部署阶段也起着一个重要作用。Docker和Vargant都是非常流行的容器化工具，它们跨开发、测试、生产环境，保持环境一致性。除此之外，它们也可以做到自动扩缩。

## 持续监控
&emsp;这在DevOps生命周期中是个非常重要的阶段，它的目的在于通过监控提升软件质量。这需要运维团队的参与，运维团队将负责监控用户行为来寻找bug或者任何不当行为。这也可以通过专业的监控工具来实现，这些工具将持续监视应用程序性能并凸显问题。  
&emsp;我们可以使用一些流行工具，例如：Splunk，Elk，Nagios，NewRelic以及Sensu。这些工具可以帮助运维人员监控应用和服务器来确保系统正常运行，还可以提升生产力和系统的可靠性，节省IT的开支。当发现问题的时候，可以反馈给开发团队，以便于他们可以在下个持续开发阶段修改。  


&emsp;这些DevOps阶段都是循环的，直至达到理想的产品。下图为你可以在各个阶段中使用的工具。
 ![DevOps工具](../images/devops/devops-tools.png)
 
&emsp;现在我们可以了解了DevOps的重要性以及在各个不同的阶段中，DevOps工具是如何参与使用的。让我们一起来看一个Facebook的案例，了解他们是如何从敏捷转向DevOps的。我们将以Facebook在2011年推出的新功能为例，重新评估其产品交付，并运行DevOps工具。  
&emsp;在2011年，Facebook发布了一些新特性——时间线，贴和音乐功能——涉及全球5亿用户使用。发布之后，Facebook产生的巨大流量使得服务器宕机。这些特性推出后，用户反馈褒贬不一，这导致了对新功能有效性的不确定结果。
 ![Facebook案例](../images/devops/3-Facebook-case-study.png)
&emsp;这导致了Facebook对战略的重新评估，导致了Facebook的暗发布(Dark Launching)技术。基于DevOps原则，Facebook创建了以下的方法来支各个新版本的发布。  
 ![Facebook案例-2](../images/devops/Facebook案例.jpg)
## Facebook的暗发布技术
&emsp;"暗发布(Dark Launching)"是一个不断通过迭代达到生产可用的过程，它会先选择一小部分用户直至生产可用。这可以让开发团队更早地获得用户反馈，测试以及验证性能。这样持续交付的直接结果是使得发布更快更容易迭代，能够确保应用本身不受发布影响，发布的内容更容易被终端用户接受。
 ![暗发布](../images/devops/4-FB-Dark-Launching-final.png)
&emsp;在这种暗发布(Dark Launching)技术中，新的特性将首先以专门的部署工作流发布至一个小规模的用户基数。在上图可以发现，只有一条部署工作流能够给一部分选择的用户部署新特性。而其他数百条部署工作流因此被关闭。这部分部署新功能的特殊用户基数将持续进行监控，并不断的反馈，识别bug。这些bug和反馈将汇总至开发团队，通过再次的开发、测试和部署至同一个用户基数，直至新特性稳定。一但稳定，新特性将被部署至其他的用户基数通过其他的部署工作流。  
&emsp;Facebook通过在特性标志或特性切换中包装代码来实现这一点，这些标志或特性切换用于控制谁可以在何时看到新特性。这暴露了应用程序基础结构的痛点和需要在正式启动之前注意的地方，同时依然可以给用户看所有的功能。一旦这些特性稳定下来，就可以通过多个版本将它们部署到其他用户。  
&emsp;这种方式使得Facebook拥有一种可控稳定的机制，来为它庞大的用户基数开发新功能。相比而言，如果新特性没有很好地反馈，他们还可以选择回滚。这也帮助了他们可以根据他们预期的用户行为来准备对应的服务器，他们也可以扩展自己的服务器。  
&emsp;Facebook、亚马逊(Amazon)、Netflix和谷歌，以及许多领先的科技巨头，在向所有人发布新功能之前，都是通过暗发布，逐步向一小部分用户发布和测试新功能。  
注：这篇文章翻译自:https://www.edureka.co/blog/what-is-devops/